```html
<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>NexaRide — NCC e trasferimenti privati 24/7</title>
  <meta name="description" content="NCC e trasferimenti privati a Milano e Lombardia. Aeroporti, città, lunghi viaggi, gruppi. Risposta immediata su WhatsApp." />

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root { color-scheme: dark; }
    html { scroll-behavior: smooth; }
    body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    section[id] { scroll-margin-top: 92px; }

    .fleet-card { position: relative; cursor: pointer; }
    .fleet-badge {
      position: absolute; top: 14px; right: 14px;
      display: none; align-items: center; gap: 8px;
      padding: 8px 10px; border-radius: 999px;
      background: rgba(0,0,0,0.55);
      border: 1px solid rgba(255,255,255,0.16);
      backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
      font-size: 12px; color: #fff; user-select: none; z-index: 5;
    }
    .fleet-badge .dot {
      width: 18px; height: 18px; border-radius: 999px;
      background: #25D366; display: grid; place-items: center;
      color: #0b1a10; font-weight: 800; line-height: 1;
    }
    .fleet-card.is-selected { outline: 2px solid rgba(255,255,255,0.92); outline-offset: 0px; }
    .fleet-card.is-selected .fleet-badge { display: inline-flex; }

    .seg-wrap { display: flex; gap: 8px; flex-wrap: wrap; }
    .seg {
      cursor: pointer;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.04);
      padding: 10px 12px;
      border-radius: 16px;
      font-weight: 600;
      font-size: 14px;
      color: rgba(255,255,255,0.9);
      user-select: none;
      transition: background .15s ease, border-color .15s ease, transform .05s ease;
    }
    .seg:hover { background: rgba(255,255,255,0.07); border-color: rgba(255,255,255,0.18); }
    .seg:active { transform: translateY(1px); }
    .seg[aria-pressed="true"] { background: rgba(37,211,102,0.14); border-color: rgba(37,211,102,0.55); }

    .lang-btn {
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.04);
      padding: 8px 10px;
      border-radius: 14px;
      font-weight: 700;
      font-size: 12px;
      color: rgba(255,255,255,0.9);
    }
    .lang-btn.is-active {
      background: rgba(37,211,102,0.14);
      border-color: rgba(37,211,102,0.55);
    }

    .stickybar {
      position: fixed; left: 0; right: 0; bottom: 0; z-index: 60;
      padding: 10px 12px;
      background: rgba(10,10,10,0.72);
      border-top: 1px solid rgba(255,255,255,0.10);
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    }

    .toast {
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: 96px; z-index: 80;
      padding: 10px 12px; border-radius: 14px;
      background: rgba(0,0,0,0.70);
      border: 1px solid rgba(255,255,255,0.14);
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      color: rgba(255,255,255,0.92);
      font-size: 13px;
      max-width: calc(100vw - 24px);
    }

    .intent-card {
      cursor: pointer;
      transition: transform .05s ease, background .15s ease, border-color .15s ease;
    }
    .intent-card:hover { background: rgba(255,255,255,0.07); }
    .intent-card:active { transform: translateY(1px); }
  </style>
</head>

<body class="bg-neutral-950 text-neutral-100 pb-24 md:pb-0" id="top">
  <!-- HEADER -->
  <header class="sticky top-0 z-50 border-b border-white/10 bg-neutral-950/70 backdrop-blur">
    <div class="mx-auto flex max-w-6xl items-center justify-between px-4 py-3">
      <a href="#top" class="flex items-center gap-3">
        <div class="h-9 w-9 rounded-xl bg-white/10 ring-1 ring-white/10 grid place-items-center font-bold">NR</div>
        <div class="leading-tight">
          <div class="font-semibold">NexaRide</div>
          <div id="t_header_sub" class="text-xs text-neutral-400">NCC • Milano • Transfer</div>
        </div>
      </a>

      <!-- MENU: tolti Aeroporti / Lago di Como -->
      <nav class="hidden items-center gap-6 text-sm text-neutral-300 md:flex">
        <a href="#fleet" class="hover:text-white" id="t_nav_fleet">Flotta</a>
        <a href="#quote" class="hover:text-white" id="t_nav_quote">Preventivo</a>
        <a href="#faq" class="hover:text-white" id="t_nav_faq">FAQ</a>
      </nav>

      <div class="flex items-center gap-2">
        <button id="langIT" class="lang-btn is-active" type="button">IT</button>
        <button id="langEN" class="lang-btn" type="button">EN</button>

        <button id="ctaWATop" type="button"
          class="ml-1 hidden sm:inline-flex items-center justify-center rounded-2xl bg-[#25D366] px-4 py-2 text-sm font-semibold text-neutral-950 hover:opacity-90 active:opacity-80">
          <span id="t_btn_whatsapp_top">WhatsApp</span>
        </button>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <main class="mx-auto max-w-6xl px-4">
    <section class="pt-8 pb-6 md:pt-12 md:pb-10">
      <div class="relative overflow-hidden rounded-3xl border border-white/10 bg-gradient-to-b from-white/5 to-white/[0.02]">
        <div class="absolute inset-0 pointer-events-none opacity-70">
          <div class="absolute -top-24 -right-24 h-64 w-64 rounded-full bg-[#25D366]/10 blur-3xl"></div>
          <div class="absolute -bottom-24 -left-24 h-64 w-64 rounded-full bg-white/10 blur-3xl"></div>
        </div>

        <div class="relative p-6 md:p-10">
          <div class="flex flex-wrap gap-2">
            <span id="t_badge_1" class="inline-flex items-center rounded-2xl border border-white/10 bg-white/5 px-3 py-1 text-xs font-semibold text-neutral-200">Disponibili 24/7</span>
            <span id="t_badge_2" class="inline-flex items-center rounded-2xl border border-white/10 bg-white/5 px-3 py-1 text-xs font-semibold text-neutral-200">Risposta rapida</span>
          </div>

          <h1 id="t_h1" class="mt-4 text-3xl font-bold tracking-tight md:text-5xl">
            NCC e trasferimenti privati – disponibili 24/7
          </h1>
          <p id="t_sub" class="mt-3 whitespace-pre-line text-base text-neutral-200/85 md:text-lg">
            Aeroporti · città · lunghi viaggi · gruppi
            Rispondiamo subito su WhatsApp
          </p>

          <div class="mt-5 flex flex-col gap-3 sm:flex-row sm:items-center">
            <button id="ctaWAHero" type="button"
              class="inline-flex w-full items-center justify-center rounded-2xl bg-[#25D366] px-5 py-4 text-base font-semibold text-neutral-950 hover:opacity-90 active:opacity-80 sm:w-auto">
              <span id="t_btn_wa_hero">Scrivici ora su WhatsApp</span>
            </button>

            <button id="ctaScrollToForm" type="button"
              class="inline-flex w-full items-center justify-center rounded-2xl border border-white/10 bg-white/5 px-5 py-4 text-base font-semibold hover:bg-white/10 active:bg-white/15 sm:w-auto">
              <span id="t_btn_fill_details">Compila i dettagli</span>
            </button>
          </div>

          <div id="t_microtrust" class="mt-3 text-sm text-neutral-200/70">
            Preventivo immediato · Senza app · Persona reale
          </div>

          <div class="mt-5 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
            <div id="t_trustline" class="text-sm text-neutral-200/70">
              Servizio NCC autorizzato · Fattura su richiesta · Pagamenti: carta/contanti/bonifico
            </div>
            <div class="flex items-center gap-2 text-sm text-neutral-200/80">
              <span class="inline-flex h-8 w-8 items-center justify-center rounded-xl border border-white/10 bg-white/5">✉</span>
              <span id="t_email_label">Email</span>:
              <a href="mailto:info@nexaride.it" class="underline underline-offset-4 hover:text-white">info@nexaride.it</a>
            </div>
          </div>

          <div class="mt-5 rounded-2xl border border-white/10 bg-white/5 p-4">
            <div id="t_season_title" class="text-sm font-semibold">Speciale eventi:</div>
            <div id="t_season_desc" class="text-sm text-neutral-200/80">Fashion Week · Salone del Mobile · Stagione Lago di Como</div>
          </div>
        </div>
      </div>
    </section>

    <!-- INTENT: niente bottoni ripetuti; card cliccabili -->
    <section class="pb-10">
      <div class="grid gap-4 md:grid-cols-3">
        <div id="intentMilan" data-intent="Milan"
          class="intent-card rounded-3xl border border-white/10 bg-white/5 p-5">
          <div id="t_intent_milan_title" class="text-lg font-semibold">Milano</div>
          <div id="t_intent_milan_desc" class="mt-1 text-sm text-neutral-200/75">City transfer, business, eventi, hotel.</div>
          <div id="t_intent_tap_1" class="mt-3 text-xs text-neutral-200/60">Tocca per compilare il preventivo</div>
        </div>

        <div id="intentAirports" data-intent="Airports"
          class="intent-card rounded-3xl border border-white/10 bg-white/5 p-5">
          <div id="t_intent_air_title" class="text-lg font-semibold">Aeroporti</div>
          <div id="t_intent_air_desc" class="mt-1 text-sm text-neutral-200/75">MXP · LIN · BGY. Meet &amp; Greet su richiesta.</div>
          <div id="t_intent_tap_2" class="mt-3 text-xs text-neutral-200/60">Tocca per compilare il preventivo</div>
        </div>

        <div id="intentLake" data-intent="Lake Como"
          class="intent-card rounded-3xl border border-white/10 bg-white/5 p-5">
          <div id="t_intent_lake_title" class="text-lg font-semibold">Lago di Como</div>
          <div id="t_intent_lake_desc" class="mt-1 text-sm text-neutral-200/75">Como · Bellagio · Varenna · Menaggio. Ideale per giornata intera o A/R.</div>
          <div id="t_intent_tap_3" class="mt-3 text-xs text-neutral-200/60">Tocca per compilare il preventivo</div>
        </div>
      </div>
    </section>

    <!-- FLEET -->
    <section id="fleet" class="pb-10">
      <div class="flex items-end justify-between gap-4">
        <div>
          <h2 id="t_fleet_title" class="text-2xl font-bold">Flotta</h2>
          <p id="t_fleet_sub" class="mt-1 text-sm text-neutral-200/75">Seleziona un veicolo: verrà impostato nel preventivo.</p>
        </div>
        <button id="ctaFleetToForm" type="button"
          class="hidden md:inline-flex items-center justify-center rounded-2xl border border-white/10 bg-white/5 px-4 py-2 text-sm font-semibold hover:bg-white/10 active:bg-white/15">
          <span id="t_btn_fleet_quote_top">Richiedi preventivo</span>
        </button>
      </div>

      <div class="mt-5 grid gap-4 md:grid-cols-3">
        <article class="fleet-card rounded-3xl border border-white/10 bg-white/5 p-4 hover:bg-white/[0.07]"
                 data-vehicle-label="Comfort / SUV (Toyota RAV4)">
          <div class="fleet-badge"><span class="dot">✓</span><span id="t_selected_badge">Selezionato</span></div>
          <img src="/rav4_industriale.png" alt="Toyota RAV4" class="h-44 w-full rounded-2xl object-cover ring-1 ring-white/10" />
          <div class="mt-4">
            <div id="t_fleet_c1_t" class="text-lg font-semibold">Comfort / SUV</div>
            <div id="t_fleet_c1_d" class="mt-1 text-sm text-neutral-200/75">Auto fino a 4 passeggeri.</div>
          </div>
        </article>

        <article class="fleet-card rounded-3xl border border-white/10 bg-white/5 p-4 hover:bg-white/[0.07]"
                 data-vehicle-label="Executive (Mercedes Classe E)">
          <div class="fleet-badge"><span class="dot">✓</span><span id="t_selected_badge_2">Selezionato</span></div>
          <img src="/classeE_industriale.png" alt="Mercedes Classe E" class="h-44 w-full rounded-2xl object-cover ring-1 ring-white/10" />
          <div class="mt-4">
            <div id="t_fleet_c2_t" class="text-lg font-semibold">Executive</div>
            <div id="t_fleet_c2_d" class="mt-1 text-sm text-neutral-200/75">Auto fino a 4 passeggeri (business/eventi).</div>
          </div>
        </article>

        <article class="fleet-card rounded-3xl border border-white/10 bg-white/5 p-4 hover:bg-white/[0.07]"
                 data-vehicle-label="Van / Gruppi (Mercedes Classe V / Vito)">
          <div class="fleet-badge"><span class="dot">✓</span><span id="t_selected_badge_3">Selezionato</span></div>
          <img src="/classeV_industriale.png" alt="Mercedes Classe V / Vito" class="h-44 w-full rounded-2xl object-cover ring-1 ring-white/10" />
          <div class="mt-4">
            <div id="t_fleet_c3_t" class="text-lg font-semibold">Van / Gruppi</div>
            <div id="t_fleet_c3_d" class="mt-1 text-sm text-neutral-200/75">Da 1 a 7 passeggeri + bagagli.</div>
          </div>
        </article>
      </div>

      <div id="t_fleet_hint" class="mt-4 text-sm text-neutral-200/70">
        Nota: Auto fino a 4 passeggeri. Van disponibile anche per 1 persona, fino a 7 passeggeri.
      </div>
    </section>

    <!-- QUOTE FORM -->
    <section id="quote" class="pb-12">
      <div class="rounded-3xl border border-white/10 bg-white/5 p-5 md:p-7">
        <div class="flex flex-col gap-2 md:flex-row md:items-end md:justify-between">
          <div>
            <h2 id="t_quote_title" class="text-2xl font-bold">Richiedi preventivo</h2>
            <p id="t_quote_sub" class="mt-1 text-sm text-neutral-200/75">
              Compila i dettagli: apriamo WhatsApp con un messaggio già strutturato.
            </p>
          </div>
          <button id="ctaWAOpenGeneric" type="button"
            class="inline-flex items-center justify-center rounded-2xl bg-[#25D366] px-4 py-3 text-sm font-semibold text-neutral-950 hover:opacity-90 active:opacity-80">
            <span id="t_btn_open_wa_form">Apri WhatsApp</span>
          </button>
        </div>

        <!-- alert -->
        <div id="formAlert" class="mt-4 hidden rounded-2xl border border-red-500/40 bg-red-500/10 p-4 text-sm">
          <div class="font-semibold" id="t_alert_title">Completa i campi richiesti</div>
          <div id="formAlertText" class="mt-1 text-neutral-200/80"></div>
        </div>

        <!-- selected vehicle -->
        <div id="selectedVehicleWrap" class="mt-4 hidden rounded-2xl border border-white/10 bg-white/5 p-4 text-sm">
          <div class="text-neutral-200/75" id="t_selected_vehicle_label">Veicolo selezionato</div>
          <div class="mt-1 font-semibold" id="selectedVehicleLabel"></div>
        </div>

        <!-- capacity notice -->
        <div id="capacityNotice" class="mt-4 hidden rounded-2xl border border-amber-400/30 bg-amber-400/10 p-4 text-sm text-neutral-200/85">
          <span id="t_capacity_notice">Auto fino a 4 passeggeri. Con 5–7 passeggeri selezioniamo Van.</span>
        </div>

        <!-- airport/station hint -->
        <div id="travelHint" class="mt-4 hidden rounded-2xl border border-white/10 bg-white/5 p-4 text-sm text-neutral-200/80">
          <span id="t_travel_hint">Hai indicato aeroporto/stazione: se vuoi aggiungi numero volo/treno e Meet &amp; Greet.</span>
        </div>

        <!-- luggage hint -->
        <div id="luggageVanHint" class="mt-4 hidden rounded-2xl border border-white/10 bg-white/5 p-4 text-sm text-neutral-200/80">
          <span id="t_luggage_hint">4 passeggeri + molti bagagli: spesso conviene Van.</span>
        </div>

        <!-- urgent hint (solo inline nel form, niente banner fisso sopra) -->
        <div id="urgentHint" class="mt-4 hidden rounded-2xl border border-red-500/30 bg-red-500/10 p-4 text-sm text-neutral-200/85">
          <div class="font-semibold" id="t_urgent_hint_t">Partenza entro 2 ore</div>
          <div id="t_urgent_hint_d" class="mt-1 text-neutral-200/80">Per urgenze, aggiungiamo “URGENTE” in cima al messaggio WhatsApp.</div>
          <div class="mt-3 flex gap-2">
            <button id="urgentWA" type="button"
              class="inline-flex flex-1 items-center justify-center rounded-2xl bg-[#25D366] px-4 py-2 text-sm font-semibold text-neutral-950 hover:opacity-90 active:opacity-80">
              <span id="t_urgent_btn">WhatsApp urgente</span>
            </button>
            <a href="tel:+393208784091"
              class="inline-flex flex-1 items-center justify-center rounded-2xl border border-white/10 bg-white/5 px-4 py-2 text-sm font-semibold hover:bg-white/10 active:bg-white/15">
              <span id="t_urgent_call">Chiama</span>
            </a>
          </div>
        </div>

        <form id="quoteForm" class="mt-5 grid gap-4 md:grid-cols-2">
          <!-- service type -->
          <div class="md:col-span-2">
            <label class="text-sm font-semibold" id="t_service_label" for="serviceType">Tipo servizio</label>
            <select id="serviceType" class="mt-2 w-full rounded-2xl border border-white/10 bg-neutral-950/50 px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-[#25D366]/40">
              <option value="transfer_oneway" id="t_service_opt1">Transfer (solo andata)</option>
              <option value="transfer_roundtrip" id="t_service_opt2">Transfer (andata/ritorno)</option>
              <option value="hourly" id="t_service_opt3">A disposizione (ore)</option>
            </select>
          </div>

          <!-- vehicle -->
          <div>
            <label class="text-sm font-semibold" id="t_vehicle_label" for="vehicle">Veicolo (obbligatorio)</label>
            <select id="vehicle" required class="mt-2 w-full rounded-2xl border border-white/10 bg-neutral-950/50 px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-[#25D366]/40">
              <option value="" id="t_vehicle_ph">Seleziona veicolo…</option>
              <option value="Comfort / SUV (Toyota RAV4)" id="t_vehicle_opt1">Comfort / SUV (Toyota RAV4)</option>
              <option value="Executive (Mercedes Classe E)" id="t_vehicle_opt2">Executive (Mercedes Classe E)</option>
              <option value="Van / Gruppi (Mercedes Classe V / Vito)" id="t_vehicle_opt3">Van / Gruppi (Mercedes Classe V / Vito)</option>
            </select>
            <div id="t_vehicle_cap_hint" class="mt-2 text-xs text-neutral-200/60">
              Auto: fino a 4 passeggeri · Van: da 1 a 7 passeggeri
            </div>
          </div>

          <!-- passengers (max 7) -->
          <div>
            <label class="text-sm font-semibold" id="t_pax_label" for="pax">Passeggeri</label>
            <select id="pax" required class="mt-2 w-full rounded-2xl border border-white/10 bg-neutral-950/50 px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-[#25D366]/40">
              <option value="" id="t_pax_ph">Seleziona…</option>
              <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option>
              <option value="5">5</option><option value="6">6</option><option value="7">7</option>
            </select>
          </div>

          <!-- from/to -->
          <div>
            <label class="text-sm font-semibold" id="t_from_label" for="from">Partenza (Pickup)</label>
            <input id="from" required type="text" autocomplete="off"
              class="mt-2 w-full rounded-2xl border border-white/10 bg-neutral-950/50 px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-[#25D366]/40"
              placeholder="Es: Hotel in centro, Milano" />
          </div>
          <div>
            <label class="text-sm font-semibold" id="t_to_label" for="to">Destinazione (Drop-off)</label>
            <input id="to" required type="text" autocomplete="off"
              class="mt-2 w-full rounded-2xl border border-white/10 bg-neutral-950/50 px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-[#25D366]/40"
              placeholder="Es: MXP Malpensa, Terminal 1" />
          </div>

          <!-- stops -->
          <div class="md:col-span-2">
            <label class="text-sm font-semibold" id="t_stops_label" for="stops">Fermate (opzionale)</label>
            <input id="stops" type="text" autocomplete="off"
              class="mt-2 w-full rounded-2xl border border-white/10 bg-neutral-950/50 px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-[#25D366]/40"
              placeholder="Es: 1 stop a Milano Centrale" />
          </div>

          <!-- when -->
          <div>
            <label class="text-sm font-semibold" id="t_when_label" for="when">Data/Ora</label>
            <input id="when" required type="datetime-local"
              class="mt-2 w-full rounded-2xl border border-white/10 bg-neutral-950/50 px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-[#25D366]/40" />
            <div class="mt-2 text-xs text-neutral-200/60" id="t_when_tz">Timezone: Europe/Rome</div>
          </div>

          <!-- multi-vehicle -->
          <div>
            <label class="text-sm font-semibold" id="t_multi_label" for="multiVehicles">Più veicoli (opzionale)</label>
            <select id="multiVehicles" class="mt-2 w-full rounded-2xl border border-white/10 bg-neutral-950/50 px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-[#25D366]/40">
              <option value="1" id="t_multi_1">1 veicolo</option>
              <option value="2" id="t_multi_2">2 veicoli</option>
              <option value="3" id="t_multi_3">3 veicoli</option>
              <option value="4" id="t_multi_4">4 veicoli</option>
            </select>
          </div>

          <!-- return conditional (NON opzionale se A/R) -->
          <div id="returnWrap" class="md:col-span-2 hidden rounded-2xl border border-white/10 bg-white/5 p-4">
            <div class="flex items-center justify-between gap-2">
              <label class="text-sm font-semibold" id="t_return_label" for="returnWhen">Ritorno (obbligatorio)</label>
              <label class="inline-flex items-center gap-2 text-xs text-neutral-200/70">
                <input id="returnTbd" type="checkbox" class="h-4 w-4 accent-[#25D366]">
                <span id="t_return_tbd">Da definire</span>
              </label>
            </div>
            <input id="returnWhen" type="datetime-local"
              class="mt-3 w-full rounded-2xl border border-white/10 bg-neutral-950/50 px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-[#25D366]/40" />
            <div class="mt-2 text-xs text-neutral-200/60" id="t_return_hint">Se non lo sai, spunta “Da definire”.</div>
          </div>

          <!-- hours conditional -->
          <div id="hoursWrap" class="md:col-span-2 hidden rounded-2xl border border-white/10 bg-white/5 p-4">
            <label class="text-sm font-semibold" id="t_hours_label" for="hours">Ore (obbligatorio)</label>
            <select id="hours" class="mt-2 w-full rounded-2xl border border-white/10 bg-neutral-950/50 px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-[#25D366]/40">
              <option value="" id="t_hours_ph">Seleziona ore…</option>
              <option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>
              <option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option>
              <option value="10">10</option><option value="11">11</option><option value="12">12</option>
            </select>
          </div>

          <!-- airport conditionals -->
          <div id="flightWrap" class="md:col-span-2 hidden">
            <label class="text-sm font-semibold" id="t_flight_label" for="flightNumber">Numero volo/treno (opzionale)</label>
            <input id="flightNumber" type="text" autocomplete="off"
              class="mt-2 w-full rounded-2xl border border-white/10 bg-neutral-950/50 px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-[#25D366]/40"
              placeholder="Es: AZ205 / FR1234 / IC 12345" />
          </div>

          <div id="meetWrap" class="md:col-span-2 hidden">
            <div class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
              <div>
                <div class="text-sm font-semibold" id="t_meet_label">Meet &amp; Greet</div>
                <div class="text-xs text-neutral-200/60" id="t_meet_sub">Accoglienza con cartello (su richiesta)</div>
              </div>
              <div class="seg-wrap">
                <button id="meetNo" type="button" class="seg" aria-pressed="true">No</button>
                <button id="meetYes" type="button" class="seg" aria-pressed="false">Sì</button>
              </div>
            </div>
          </div>

          <div id="airportExtrasWrap" class="md:col-span-2 hidden rounded-2xl border border-white/10 bg-white/5 p-4">
            <div class="grid gap-4 md:grid-cols-2">
              <div>
                <label class="text-sm font-semibold" id="t_wait_label" for="waitTime">Attesa (opzionale)</label>
                <select id="waitTime" class="mt-2 w-full rounded-2xl border border-white/10 bg-neutral-950/50 px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-[#25D366]/40">
                  <option value="" id="t_wait_0">Nessuna / standard</option>
                  <option value="15">+15 min</option>
                  <option value="30">+30 min</option>
                  <option value="45">+45 min</option>
                  <option value="60">+60 min</option>
                  <option value="90">+90 min</option>
                </select>
                <div class="mt-2 text-xs text-neutral-200/60" id="t_wait_hint">Utile se atterraggio/ritiro bagagli può tardare.</div>
              </div>
              <div>
                <label class="text-sm font-semibold" id="t_seat_label" for="childSeat">Seggiolino bimbo (opzionale)</label>
                <select id="childSeat" class="mt-2 w-full rounded-2xl border border-white/10 bg-neutral-950/50 px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-[#25D366]/40">
                  <option value="" id="t_seat_0">Nessuno</option>
                  <option value="infant" id="t_seat_1">Infant (0–13 kg)</option>
                  <option value="child" id="t_seat_2">Child (9–18 kg)</option>
                  <option value="booster" id="t_seat_3">Booster (15–36 kg)</option>
                </select>
              </div>
            </div>
          </div>

          <!-- contact preference -->
          <div class="md:col-span-2">
            <div class="text-sm font-semibold" id="t_contactpref_label">Preferenza contatto</div>
            <div class="mt-2 seg-wrap">
              <button id="prefWA" type="button" class="seg" aria-pressed="true">WhatsApp</button>
              <button id="prefCall" type="button" class="seg" aria-pressed="false">Chiamata</button>
            </div>
          </div>

          <!-- luggage -->
          <div class="md:col-span-2">
            <div class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
              <div>
                <div class="text-sm font-semibold" id="t_lug_label">Bagagli</div>
                <div class="text-xs text-neutral-200/60" id="t_lug_sub">Più info = preventivo più veloce.</div>
              </div>
              <div class="seg-wrap">
                <button id="lugNone" type="button" class="seg" aria-pressed="true"><span id="t_lug_none">Nessuno</span></button>
                <button id="lugSome" type="button" class="seg" aria-pressed="false"><span id="t_lug_some">1–2</span></button>
                <button id="lugMany" type="button" class="seg" aria-pressed="false"><span id="t_lug_many">Molti</span></button>
              </div>
            </div>

            <div class="mt-3 grid gap-3 md:grid-cols-2">
              <div>
                <label class="text-sm font-semibold" id="t_big_label" for="bigSuitcases">Valigie grandi</label>
                <select id="bigSuitcases" class="mt-2 w-full rounded-2xl border border-white/10 bg-neutral-950/50 px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-[#25D366]/40">
                  <option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4+</option>
                </select>
              </div>
              <div>
                <label class="text-sm font-semibold" id="t_carry_label" for="carryOn">Bagagli a mano</label>
                <select id="carryOn" class="mt-2 w-full rounded-2xl border border-white/10 bg-neutral-950/50 px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-[#25D366]/40">
                  <option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4+</option>
                </select>
              </div>
            </div>

            <div id="notesHint" class="mt-2 text-xs text-neutral-200/60"></div>
          </div>

          <!-- payment -->
          <div class="md:col-span-2">
            <div class="text-sm font-semibold" id="t_payment_label">Pagamento</div>
            <div class="mt-2 seg-wrap">
              <button id="payCard" type="button" class="seg" aria-pressed="true"><span id="t_pay_card">Carta</span></button>
              <button id="payCash" type="button" class="seg" aria-pressed="false"><span id="t_pay_cash">Contanti</span></button>
              <button id="payBank" type="button" class="seg" aria-pressed="false"><span id="t_pay_bank">Bonifico</span></button>
              <button id="payApple" type="button" class="seg" aria-pressed="false"><span id="t_pay_apple">Apple/Google Pay</span></button>
            </div>
          </div>

          <!-- invoice -->
          <div class="md:col-span-2">
            <label class="inline-flex items-center gap-3 rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm">
              <input id="invoice" type="checkbox" class="h-4 w-4 accent-[#25D366]">
              <span id="t_invoice_label">Richiedo fattura</span>
            </label>
          </div>

          <!-- name/phone -->
          <div>
            <label class="text-sm font-semibold" id="t_name_label" for="name">Nome (opzionale)</label>
            <input id="name" type="text" autocomplete="name"
              class="mt-2 w-full rounded-2xl border border-white/10 bg-neutral-950/50 px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-[#25D366]/40"
              placeholder="Es: Marco" />
          </div>
          <div>
            <label class="text-sm font-semibold" id="t_phone_label" for="phoneInput">Telefono (opzionale)</label>
            <input id="phoneInput" type="tel" autocomplete="tel"
              class="mt-2 w-full rounded-2xl border border-white/10 bg-neutral-950/50 px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-[#25D366]/40"
              placeholder="+39 ..." />
          </div>

          <!-- notes -->
          <div class="md:col-span-2">
            <label class="text-sm font-semibold" id="t_notes_label" for="notes">Note (opzionale)</label>
            <textarea id="notes" rows="4"
              class="mt-2 w-full rounded-2xl border border-white/10 bg-neutral-950/50 px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-[#25D366]/40"
              placeholder="Es: 2 bambini, richiesta seggiolino, orario flessibile, ecc."></textarea>
          </div>

          <!-- submit -->
          <div class="md:col-span-2 flex flex-col gap-3 md:flex-row">
            <button id="submitBtn" type="submit"
              class="inline-flex w-full items-center justify-center rounded-2xl bg-[#25D366] px-5 py-4 text-base font-semibold text-neutral-950 hover:opacity-90 active:opacity-80 md:w-auto">
              <span id="t_submit">Invia su WhatsApp</span>
            </button>

            <button id="resetBtn" type="button"
              class="inline-flex w-full items-center justify-center rounded-2xl border border-white/10 bg-white/5 px-5 py-4 text-base font-semibold hover:bg-white/10 active:bg-white/15 md:w-auto">
              <span id="t_reset">Reset</span>
            </button>
          </div>

          <div class="md:col-span-2 text-xs text-neutral-200/60" id="t_privacy_note">
            Inviando, aprirai WhatsApp con il messaggio già compilato. Nessun dato viene inviato a server dal sito.
          </div>
        </form>
      </div>
    </section>

    <!-- REVIEWS (niente “Cliente” come nome) -->
    <section class="pb-12">
      <h2 id="t_reviews_title" class="text-2xl font-bold">Recensioni</h2>
      <p id="t_reviews_sub" class="mt-1 text-sm text-neutral-200/75">Esempi (placeholder): aggiungeremo le recensioni reali.</p>

      <div class="mt-5 grid gap-4 md:grid-cols-3">
        <div class="rounded-3xl border border-white/10 bg-white/5 p-5">
          <div class="text-sm font-semibold">★★★★★</div>
          <div id="t_r1" class="mt-2 text-sm text-neutral-200/80">Puntuali, auto pulita e comunicazione rapidissima su WhatsApp.</div>
          <div class="mt-3 text-xs text-neutral-200/60">— M.R.</div>
        </div>
        <div class="rounded-3xl border border-white/10 bg-white/5 p-5">
          <div class="text-sm font-semibold">★★★★★</div>
          <div id="t_r2" class="mt-2 text-sm text-neutral-200/80">Transfer aeroporto perfetto, Meet &amp; Greet comodo e professionale.</div>
          <div class="mt-3 text-xs text-neutral-200/60">— S.L.</div>
        </div>
        <div class="rounded-3xl border border-white/10 bg-white/5 p-5">
          <div class="text-sm font-semibold">★★★★★</div>
          <div id="t_r3" class="mt-2 text-sm text-neutral-200/80">Ottimo per gruppo con bagagli. Preventivo chiaro e veloce.</div>
          <div class="mt-3 text-xs text-neutral-200/60">— A.K.</div>
        </div>
      </div>
    </section>

    <!-- FAQ -->
    <section id="faq" class="pb-12">
      <h2 id="t_faq_title" class="text-2xl font-bold">FAQ</h2>
      <div class="mt-5 grid gap-4 md:grid-cols-2">
        <div class="rounded-3xl border border-white/10 bg-white/5 p-5">
          <div id="t_faq_q1" class="font-semibold">Quanto tempo prima devo prenotare?</div>
          <div id="t_faq_a1" class="mt-2 text-sm text-neutral-200/80">Anche last-minute. Se è entro 2 ore, usa WhatsApp urgente.</div>
        </div>
        <div class="rounded-3xl border border-white/10 bg-white/5 p-5">
          <div id="t_faq_q2" class="font-semibold">Fate fattura?</div>
          <div id="t_faq_a2" class="mt-2 text-sm text-neutral-200/80">Sì, su richiesta. Spunta “Richiedo fattura” nel preventivo.</div>
        </div>
        <div class="rounded-3xl border border-white/10 bg-white/5 p-5">
          <div id="t_faq_q3" class="font-semibold">Pagamenti accettati?</div>
          <div id="t_faq_a3" class="mt-2 text-sm text-neutral-200/80">Carta, contanti, bonifico, Apple/Google Pay.</div>
        </div>
        <div class="rounded-3xl border border-white/10 bg-white/5 p-5">
          <div id="t_faq_q4" class="font-semibold">Quanti passeggeri?</div>
          <div id="t_faq_a4" class="mt-2 text-sm text-neutral-200/80">Auto fino a 4 passeggeri. Van da 1 a 7 passeggeri (consigliato con molti bagagli).</div>
        </div>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="border-t border-white/10 bg-neutral-950">
    <div class="mx-auto max-w-6xl px-4 py-10">
      <div class="flex flex-col gap-6 md:flex-row md:items-start md:justify-between">
        <div>
          <div class="text-lg font-semibold">NexaRide</div>
          <div class="mt-1 text-sm text-neutral-200/70" id="t_footer_sub">NCC Milano · Transfer privati 24/7</div>
          <div class="mt-3 text-sm text-neutral-200/80">
            <div>WhatsApp: <button id="waInline" type="button" class="underline underline-offset-4 hover:text-white">+39 320 878 4091</button></div>
            <div><span id="t_email_label_2">Email</span>: <a href="mailto:info@nexaride.it" class="underline underline-offset-4 hover:text-white">info@nexaride.it</a></div>
          </div>
          <div class="mt-4 text-xs text-neutral-200/50">© <span id="y"></span> NexaRide</div>
        </div>

        <div class="flex flex-col gap-3">
          <div class="text-sm font-semibold" id="t_footer_links">Link</div>
          <div class="flex flex-wrap gap-3 text-sm">
            <a id="t_privacy" href="#privacy" class="rounded-2xl border border-white/10 bg-white/5 px-4 py-2 font-semibold hover:bg-white/10">Privacy Policy</a>
            <a id="t_cookie" href="#cookie" class="rounded-2xl border border-white/10 bg-white/5 px-4 py-2 font-semibold hover:bg-white/10">Cookie Policy</a>
          </div>

          <div class="flex flex-wrap gap-3 text-sm">
            <button id="ctaWAFooter" type="button"
              class="rounded-2xl bg-[#25D366] px-4 py-2 font-semibold text-neutral-950 hover:opacity-90 active:opacity-80">
              <span id="t_footer_wa">WhatsApp</span>
            </button>
            <a class="rounded-2xl border border-white/10 bg-white/5 px-4 py-2 font-semibold hover:bg-white/10"
               href="tel:+393208784091"><span id="t_footer_call">Chiama</span></a>
            <button id="ctaFooterToForm" type="button"
              class="rounded-2xl border border-white/10 bg-white/5 px-4 py-2 font-semibold hover:bg-white/10">
              <span id="t_footer_quote">Preventivo</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- STICKY MOBILE -->
  <div class="stickybar md:hidden">
    <div class="mx-auto max-w-6xl flex gap-2 px-2">
      <button id="stickyWA" type="button"
        class="flex-1 inline-flex items-center justify-center rounded-2xl bg-[#25D366] px-4 py-3 text-sm font-semibold text-neutral-950 hover:opacity-90 active:opacity-80">
        <span id="t_sticky_wa">WhatsApp</span>
      </button>
      <button id="stickyQuote" type="button"
        class="flex-1 inline-flex items-center justify-center rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm font-semibold hover:bg-white/10 active:bg-white/15">
        <span id="t_sticky_quote">Preventivo</span>
      </button>
    </div>
  </div>

  <!-- TOAST -->
  <div id="toast" class="toast hidden"></div>

  <script>
    // ---------- CONFIG ----------
    const WA_PHONE = "393208784091";
    const VAN_LABEL = "Van / Gruppi (Mercedes Classe V / Vito)";
    const STORAGE_KEY = "nexaride_last_quote_v2";
    const TZ_LABEL = "Europe/Rome";

    // ---------- I18N ----------
    const I18N = {
      it: {
        headerSub: "NCC • Milano • Transfer",
        nav: { fleet:"Flotta", quote:"Preventivo", faq:"FAQ" },
        badges: { b1:"Disponibili 24/7", b2:"Risposta rapida" },
        h1: "NCC e trasferimenti privati – disponibili 24/7",
        sub: "Aeroporti · città · lunghi viaggi · gruppi\nRispondiamo subito su WhatsApp",
        microtrust: "Preventivo immediato · Senza app · Persona reale",
        trustline: "Servizio NCC autorizzato · Fattura su richiesta · Pagamenti: carta/contanti/bonifico",
        email: "Email",
        seasonTitle:"Speciale eventi:",
        seasonDesc:"Fashion Week · Salone del Mobile · Stagione Lago di Como",
        btn: {
          wa:"WhatsApp",
          waHero:"Scrivici ora su WhatsApp",
          fill:"Compila i dettagli",
          openWa:"Apri WhatsApp",
          fleetQuote:"Richiedi preventivo",
          submit:"Invia su WhatsApp",
          reset:"Reset",
          urgentBtn:"WhatsApp urgente",
          call:"Chiama"
        },
        intent: {
          milanTitle:"Milano",
          milanDesc:"City transfer, business, eventi, hotel.",
          airTitle:"Aeroporti",
          airDesc:"MXP · LIN · BGY. Meet & Greet su richiesta.",
          lakeTitle:"Lago di Como",
          lakeDesc:"Como · Bellagio · Varenna · Menaggio. Ideale per giornata intera o A/R.",
          tap:"Tocca per compilare il preventivo"
        },
        fleet: {
          title:"Flotta",
          sub:"Seleziona un veicolo: verrà impostato nel preventivo.",
          c1t:"Comfort / SUV",
          c1d:"Auto fino a 4 passeggeri.",
          c2t:"Executive",
          c2d:"Auto fino a 4 passeggeri (business/eventi).",
          c3t:"Van / Gruppi",
          c3d:"Da 1 a 7 passeggeri + bagagli.",
          hint:"Nota: Auto fino a 4 passeggeri. Van disponibile anche per 1 persona, fino a 7 passeggeri.",
          selected:"Selezionato"
        },
        quote: {
          title:"Richiedi preventivo",
          sub:"Compila i dettagli: apriamo WhatsApp con un messaggio già strutturato.",
          selectedVehicle:"Veicolo selezionato",
          capNotice:"Auto fino a 4 passeggeri. Con 5–7 passeggeri selezioniamo Van.",
          travelHint:"Hai indicato aeroporto/stazione: se vuoi aggiungi numero volo/treno e Meet & Greet.",
          luggageHint:"4 passeggeri + molti bagagli: spesso conviene Van.",
          urgentT:"Partenza entro 2 ore",
          urgentD:"Per urgenze, aggiungiamo “URGENTE” in cima al messaggio WhatsApp.",
          serviceLabel:"Tipo servizio",
          service1:"Transfer (solo andata)",
          service2:"Transfer (andata/ritorno)",
          service3:"A disposizione (ore)",
          vehicleLabel:"Veicolo (obbligatorio)",
          vehiclePH:"Seleziona veicolo…",
          vehicleCapHint:"Auto: fino a 4 passeggeri · Van: da 1 a 7 passeggeri",
          paxLabel:"Passeggeri",
          paxPH:"Seleziona…",
          fromLabel:"Partenza (Pickup)",
          fromPH:"Es: Hotel in centro, Milano",
          toLabel:"Destinazione (Drop-off)",
          toPH:"Es: MXP Malpensa, Terminal 1",
          stopsLabel:"Fermate (opzionale)",
          stopsPH:"Es: 1 stop a Milano Centrale",
          whenLabel:"Data/Ora",
          whenTZ:"Timezone: Europe/Rome",
          multiLabel:"Più veicoli (opzionale)",
          multi1:"1 veicolo", multi2:"2 veicoli", multi3:"3 veicoli", multi4:"4 veicoli",
          returnLabel:"Ritorno (obbligatorio)",
          returnTbd:"Da definire",
          returnHint:"Se non lo sai, spunta “Da definire”.",
          hoursLabel:"Ore (obbligatorio)",
          hoursPH:"Seleziona ore…",
          flightLabel:"Numero volo/treno (opzionale)",
          meetLabel:"Meet & Greet",
          meetSub:"Accoglienza con cartello (su richiesta)",
          waitLabel:"Attesa (opzionale)",
          wait0:"Nessuna / standard",
          waitHint:"Utile se atterraggio/ritiro bagagli può tardare.",
          seatLabel:"Seggiolino bimbo (opzionale)",
          seat0:"Nessuno",
          seat1:"Infant (0–13 kg)",
          seat2:"Child (9–18 kg)",
          seat3:"Booster (15–36 kg)",
          contactPref:"Preferenza contatto",
          lugLabel:"Bagagli",
          lugSub:"Più info = preventivo più veloce.",
          lugNone:"Nessuno",
          lugSome:"1–2",
          lugMany:"Molti",
          bigLabel:"Valigie grandi",
          carryLabel:"Bagagli a mano",
          payLabel:"Pagamento",
          payCard:"Carta",
          payCash:"Contanti",
          payBank:"Bonifico",
          payApple:"Apple/Google Pay",
          invoiceLabel:"Richiedo fattura",
          nameLabel:"Nome (opzionale)",
          namePH:"Es: Marco",
          phoneLabel:"Telefono (opzionale)",
          phonePH:"+39 ...",
          notesLabel:"Note (opzionale)",
          notesPH:"Es: 2 bambini, richiesta seggiolino, orario flessibile, ecc.",
          privacyNote:"Inviando, aprirai WhatsApp con il messaggio già compilato. Nessun dato viene inviato a server dal sito."
        },
        reviews: { title:"Recensioni", sub:"Esempi (placeholder): aggiungeremo le recensioni reali." },
        faq: {
          title:"FAQ",
          q1:"Quanto tempo prima devo prenotare?",
          a1:"Anche last-minute. Se è entro 2 ore, usa WhatsApp urgente.",
          q2:"Fate fattura?",
          a2:"Sì, su richiesta. Spunta “Richiedo fattura” nel preventivo.",
          q3:"Pagamenti accettati?",
          a3:"Carta, contanti, bonifico, Apple/Google Pay.",
          q4:"Quanti passeggeri?",
          a4:"Auto fino a 4 passeggeri. Van da 1 a 7 passeggeri (consigliato con molti bagagli)."
        },
        footer: { sub:"NCC Milano · Transfer privati 24/7", links:"Link", wa:"WhatsApp", call:"Chiama", quote:"Preventivo" },
        alert: {
          title:"Completa i campi richiesti",
          missingPrefix:"Manca: ",
          carCapacity:"Con 5–7 passeggeri serve Van. Abbiamo selezionato Van automaticamente."
        },
        toasts: { blocked:"Evita doppio invio: sto aprendo WhatsApp…" },
        waTemplates: {
          urgent: "URGENTE\n\n",
          header: "Ciao! Vorrei un preventivo NCC con NexaRide.\n\n",
          ctx: "Richiesta: ",
          labels: {
            service:"Tipo servizio",
            hours:"Ore",
            return:"Ritorno",
            vehicle:"Categoria veicolo",
            vehiclesN:"N. veicoli",
            from:"Partenza",
            to:"Destinazione",
            stops:"Fermate",
            when:"Data/Ora",
            pax:"Passeggeri",
            flight:"Volo/Treno",
            meet:"Meet & Greet",
            wait:"Attesa",
            seat:"Seggiolino",
            lug:"Bagagli",
            pay:"Pagamento",
            inv:"Fattura",
            pref:"Preferenza contatto",
            name:"Nome",
            phone:"Telefono",
            notes:"Note"
          }
        }
      },
      en: {
        headerSub: "Chauffeur • Milan • Transfers",
        nav: { fleet:"Fleet", quote:"Quote", faq:"FAQ" },
        badges: { b1:"Available 24/7", b2:"Fast reply" },
        h1: "Private chauffeur & transfers — available 24/7",
        sub: "Airports · city · long trips · groups\nWe reply fast on WhatsApp",
        microtrust: "Instant quote · No app · Real person",
        trustline: "Licensed NCC service · Invoice on request · Payments: card/cash/bank",
        email: "Email",
        seasonTitle:"Events season:",
        seasonDesc:"Fashion Week · Salone del Mobile · Lake Como season",
        btn: {
          wa:"WhatsApp",
          waHero:"Message us on WhatsApp",
          fill:"Fill the details",
          openWa:"Open WhatsApp",
          fleetQuote:"Request quote",
          submit:"Send on WhatsApp",
          reset:"Reset",
          urgentBtn:"Urgent WhatsApp",
          call:"Call"
        },
        intent: {
          milanTitle:"Milan",
          milanDesc:"City transfers, business, events, hotels.",
          airTitle:"Airports",
          airDesc:"MXP · LIN · BGY. Meet & Greet on request.",
          lakeTitle:"Lake Como",
          lakeDesc:"Como · Bellagio · Varenna · Menaggio. Ideal for full day or round trip.",
          tap:"Tap to fill the quote"
        },
        fleet: {
          title:"Fleet",
          sub:"Select a vehicle: it will be set in your quote request.",
          c1t:"Comfort / SUV",
          c1d:"Car up to 4 passengers.",
          c2t:"Executive",
          c2d:"Car up to 4 passengers (business/events).",
          c3t:"Van / Groups",
          c3d:"From 1 to 7 passengers + luggage.",
          hint:"Note: Car up to 4 passengers. Van available also for 1 person, up to 7 passengers.",
          selected:"Selected"
        },
        quote: {
          title:"Request a quote",
          sub:"Fill the details: we open WhatsApp with a structured message.",
          selectedVehicle:"Selected vehicle",
          capNotice:"Car up to 4 passengers. With 5–7 passengers we select Van.",
          travelHint:"You mentioned an airport/station: add flight/train number and Meet & Greet if needed.",
          luggageHint:"4 passengers + lots of luggage: Van is often better.",
          urgentT:"Departure within 2 hours",
          urgentD:"For urgent trips we add “URGENT” at the top of the WhatsApp message.",
          serviceLabel:"Service type",
          service1:"Transfer (one-way)",
          service2:"Transfer (round trip)",
          service3:"Hourly (as directed)",
          vehicleLabel:"Vehicle (required)",
          vehiclePH:"Select vehicle…",
          vehicleCapHint:"Car: up to 4 passengers · Van: from 1 to 7 passengers",
          paxLabel:"Passengers",
          paxPH:"Select…",
          fromLabel:"Pickup",
          fromPH:"E.g. Hotel in Milan city center",
          toLabel:"Drop-off",
          toPH:"E.g. MXP Malpensa, Terminal 1",
          stopsLabel:"Stops (optional)",
          stopsPH:"E.g. 1 stop at Milano Centrale",
          whenLabel:"Date/Time",
          whenTZ:"Timezone: Europe/Rome",
          multiLabel:"Multiple vehicles (optional)",
          multi1:"1 vehicle", multi2:"2 vehicles", multi3:"3 vehicles", multi4:"4 vehicles",
          returnLabel:"Return (required)",
          returnTbd:"To be defined",
          returnHint:"If unknown, tick “To be defined”.",
          hoursLabel:"Hours (required)",
          hoursPH:"Select hours…",
          flightLabel:"Flight/train number (optional)",
          meetLabel:"Meet & Greet",
          meetSub:"Welcome sign (on request)",
          waitLabel:"Waiting time (optional)",
          wait0:"None / standard",
          waitHint:"Useful if landing/baggage may be delayed.",
          seatLabel:"Child seat (optional)",
          seat0:"None",
          seat1:"Infant (0–13 kg)",
          seat2:"Child (9–18 kg)",
          seat3:"Booster (15–36 kg)",
          contactPref:"Contact preference",
          lugLabel:"Luggage",
          lugSub:"More info = faster quote.",
          lugNone:"None",
          lugSome:"1–2",
          lugMany:"Many",
          bigLabel:"Large suitcases",
          carryLabel:"Carry-on",
          payLabel:"Payment",
          payCard:"Card",
          payCash:"Cash",
          payBank:"Bank transfer",
          payApple:"Apple/Google Pay",
          invoiceLabel:"I need an invoice",
          nameLabel:"Name (optional)",
          namePH:"E.g. Mark",
          phoneLabel:"Phone (optional)",
          phonePH:"+39 ...",
          notesLabel:"Notes (optional)",
          notesPH:"E.g. 2 kids, child seat requested, flexible time, etc.",
          privacyNote:"When you send, WhatsApp opens with a pre-filled message. No data is sent to a server."
        },
        reviews: { title:"Reviews", sub:"Examples (placeholders): real reviews will be added." },
        faq: {
          title:"FAQ",
          q1:"How early should I book?",
          a1:"Even last-minute. If within 2 hours, use Urgent WhatsApp.",
          q2:"Do you issue invoices?",
          a2:"Yes, on request. Tick “I need an invoice”.",
          q3:"Accepted payments?",
          a3:"Card, cash, bank transfer, Apple/Google Pay.",
          q4:"How many passengers?",
          a4:"Car up to 4 passengers. Van from 1 to 7 passengers (recommended with lots of luggage)."
        },
        footer: { sub:"Milan chauffeur · Private transfers 24/7", links:"Links", wa:"WhatsApp", call:"Call", quote:"Quote" },
        alert: {
          title:"Please complete required fields",
          missingPrefix:"Missing: ",
          carCapacity:"With 5–7 passengers you need a Van. We selected Van automatically."
        },
        toasts: { blocked:"Preventing double send: opening WhatsApp…" },
        waTemplates: {
          urgent: "URGENT\n\n",
          header: "Hi! I’d like a chauffeur/NCC quote with NexaRide.\n\n",
          ctx: "Request: ",
          labels: {
            service:"Service",
            hours:"Hours",
            return:"Return",
            vehicle:"Vehicle",
            vehiclesN:"# Vehicles",
            from:"Pickup",
            to:"Drop-off",
            stops:"Stops",
            when:"Date/Time",
            pax:"Passengers",
            flight:"Flight/Train",
            meet:"Meet & Greet",
            wait:"Waiting",
            seat:"Child seat",
            lug:"Luggage",
            pay:"Payment",
            inv:"Invoice",
            pref:"Contact pref",
            name:"Name",
            phone:"Phone",
            notes:"Notes"
          }
        }
      }
    };

    // ---------- STATE ----------
    let LANG = (localStorage.getItem("nexaride_lang") || "it");
    let contactPref = "WhatsApp"; // WhatsApp | Call
    let luggage = "none";         // none | some | many
    let meetGreet = "no";         // no | yes
    let payment = "card";         // card | cash | bank | apple
    let lastContextTag = "";      // Milan | Airports | Lake Como | ""

    let isSubmitting = false;
    let lastSubmitAt = 0;

    // ---------- helpers ----------
    const $ = (id) => document.getElementById(id);

    function showToast(text) {
      const el = $("toast");
      el.textContent = text;
      el.classList.remove("hidden");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => el.classList.add("hidden"), 1500);
    }

    function openWhatsApp(text) {
      const url = "https://wa.me/" + WA_PHONE + "?text=" + encodeURIComponent(text);
      window.open(url, "_blank", "noopener,noreferrer");
    }

    function parseDT(value) {
      if (!value) return null;
      const d = new Date(value);
      return isNaN(d.getTime()) ? null : d;
    }

    function setMinNow(el) {
      if (!el) return;
      const now = new Date();
      const pad = (n) => String(n).padStart(2, "0");
      el.min = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}T${pad(now.getHours())}:${pad(now.getMinutes())}`;
    }

    function isAirportOrStationText(text) {
      const t = (text || "").toLowerCase();
      const keys = [
        "mxp","malpensa","lin","linate","bgy","orio","orio al serio","airport","terminal","arrivals","departures",
        "stazione","station","train","rail","centrale","garibaldi","cadorna","rogoredo","lambrate"
      ];
      return keys.some(k => t.includes(k));
    }

    function formatDT(lang, dtLocalValue) {
      if (!dtLocalValue) return "";
      const d = new Date(dtLocalValue);
      if (isNaN(d.getTime())) return dtLocalValue;
      return d.toLocaleString(lang === "en" ? "en-GB" : "it-IT", {
        year:"numeric", month:"2-digit", day:"2-digit", hour:"2-digit", minute:"2-digit"
      });
    }

    function getPax() {
      const n = parseInt(($("pax").value || "").trim(), 10);
      return Number.isFinite(n) ? n : null;
    }

    function isCarVehicle(v) {
      return v === "Comfort / SUV (Toyota RAV4)" || v === "Executive (Mercedes Classe E)";
    }

    function clearFleetSelection() {
      document.querySelectorAll(".fleet-card").forEach(c => c.classList.remove("is-selected"));
    }

    function selectFleetByLabel(label) {
      clearFleetSelection();
      const card = Array.from(document.querySelectorAll(".fleet-card"))
        .find(c => c.getAttribute("data-vehicle-label") === label);
      if (card) card.classList.add("is-selected");
    }

    // ---------- elements ----------
    const vehicleEl = $("vehicle");
    const paxEl = $("pax");
    const fromEl = $("from");
    const toEl = $("to");
    const stopsEl = $("stops");
    const whenEl = $("when");
    const serviceEl = $("serviceType");
    const returnWrap = $("returnWrap");
    const returnWhenEl = $("returnWhen");
    const returnTbdEl = $("returnTbd");
    const hoursWrap = $("hoursWrap");
    const hoursEl = $("hours");

    const travelHint = $("travelHint");
    const flightWrap = $("flightWrap");
    const flightEl = $("flightNumber");
    const meetWrap = $("meetWrap");
    const meetNo = $("meetNo");
    const meetYes = $("meetYes");
    const airportExtrasWrap = $("airportExtrasWrap");
    const waitEl = $("waitTime");
    const seatEl = $("childSeat");

    const urgentHint = $("urgentHint");
    const urgentWA = $("urgentWA");

    const capacityNotice = $("capacityNotice");
    const luggageVanHint = $("luggageVanHint");

    const selectedVehicleWrap = $("selectedVehicleWrap");
    const selectedVehicleLabel = $("selectedVehicleLabel");

    const formAlert = $("formAlert");
    const formAlertText = $("formAlertText");

    const prefWA = $("prefWA");
    const prefCall = $("prefCall");

    const lugNone = $("lugNone");
    const lugSome = $("lugSome");
    const lugMany = $("lugMany");

    const bigEl = $("bigSuitcases");
    const carryEl = $("carryOn");
    const notesHintEl = $("notesHint");

    const payCard = $("payCard");
    const payCash = $("payCash");
    const payBank = $("payBank");
    const payApple = $("payApple");

    const invoiceEl = $("invoice");
    const nameEl = $("name");
    const phoneEl = $("phoneInput");
    const notesEl = $("notes");
    const multiVehiclesEl = $("multiVehicles");

    const submitBtn = $("submitBtn");

    // ---------- state setters ----------
    function setContactPref(v) {
      contactPref = v;
      prefWA.setAttribute("aria-pressed", v === "WhatsApp" ? "true" : "false");
      prefCall.setAttribute("aria-pressed", v === "Call" ? "true" : "false");
    }

    function setLuggage(v) {
      luggage = v;
      lugNone.setAttribute("aria-pressed", v === "none" ? "true" : "false");
      lugSome.setAttribute("aria-pressed", v === "some" ? "true" : "false");
      lugMany.setAttribute("aria-pressed", v === "many" ? "true" : "false");
      updateHints();
      save();
    }

    function setMeet(v) {
      meetGreet = v;
      meetNo.setAttribute("aria-pressed", v === "no" ? "true" : "false");
      meetYes.setAttribute("aria-pressed", v === "yes" ? "true" : "false");
      save();
    }

    function setPayment(v) {
      payment = v;
      payCard.setAttribute("aria-pressed", v === "card" ? "true" : "false");
      payCash.setAttribute("aria-pressed", v === "cash" ? "true" : "false");
      payBank.setAttribute("aria-pressed", v === "bank" ? "true" : "false");
      payApple.setAttribute("aria-pressed", v === "apple" ? "true" : "false");
      save();
    }

    // ---------- conditionals ----------
    function serviceNeedsReturn() { return serviceEl.value === "transfer_roundtrip"; }
    function serviceNeedsHours() { return serviceEl.value === "hourly"; }

    function updateServiceConditionals() {
      const needsReturn = serviceNeedsReturn();
      const needsHours = serviceNeedsHours();

      returnWrap.classList.toggle("hidden", !needsReturn);
      hoursWrap.classList.toggle("hidden", !needsHours);

      // A/R: return REQUIRED unless TBD is checked
      if (needsReturn) {
        setMinNow(returnWhenEl);
        if (returnTbdEl.checked) {
          returnWhenEl.required = false;
          returnWhenEl.disabled = true;
          returnWhenEl.value = "";
        } else {
          returnWhenEl.disabled = false;
          returnWhenEl.required = true; // required per tua richiesta
        }
      } else {
        returnTbdEl.checked = false;
        returnWhenEl.required = false;
        returnWhenEl.disabled = false;
        returnWhenEl.value = "";
      }

      // hourly: hours required
      hoursEl.required = needsHours;
      if (!needsHours) hoursEl.value = "";

      save();
    }

    function updateTravelConditionals() {
      const show = isAirportOrStationText(fromEl.value) || isAirportOrStationText(toEl.value);
      travelHint.classList.toggle("hidden", !show);
      flightWrap.classList.toggle("hidden", !show);
      meetWrap.classList.toggle("hidden", !show);
      airportExtrasWrap.classList.toggle("hidden", !show);

      if (!show) {
        flightEl.value = "";
        waitEl.value = "";
        seatEl.value = "";
        setMeet("no");
      }
    }

    function updateUrgentHint() {
      const dt = parseDT(whenEl.value);
      if (!dt) { urgentHint.classList.add("hidden"); return; }
      const diffH = (dt.getTime() - Date.now()) / 3600000;
      const isUrgent = (diffH >= 0 && diffH <= 2);
      urgentHint.classList.toggle("hidden", !isUrgent);
    }

    function updateSelectedVehicleUI() {
      const v = (vehicleEl.value || "").trim();
      if (!v) {
        selectedVehicleWrap.classList.add("hidden");
        selectedVehicleLabel.textContent = "";
        return;
      }
      selectedVehicleWrap.classList.remove("hidden");
      selectedVehicleLabel.textContent = v;
    }

    function enforceCapacity() {
      const pax = getPax();
      const v = (vehicleEl.value || "").trim();

      // hint/notice
      capacityNotice.classList.toggle("hidden", !(pax && pax >= 5));

      // regola: auto max 4; van 1-7
      if (pax && pax >= 5) {
        if (v !== VAN_LABEL) {
          vehicleEl.value = VAN_LABEL;
          selectFleetByLabel(VAN_LABEL);
          updateSelectedVehicleUI();
        }
      } else if (pax && pax <= 4) {
        // van resta sempre consentito (anche per 1 persona): non facciamo downgrade automatico
      }

      // se utente prova a forzare auto con pax>4: correggiamo a van + alert
      if (pax && pax >= 5 && v && isCarVehicle(v)) {
        vehicleEl.value = VAN_LABEL;
        selectFleetByLabel(VAN_LABEL);
        updateSelectedVehicleUI();
        showAlert([I18N[LANG].alert.carCapacity]);
      }

      updateHints();
      save();
    }

    function updateHints() {
      const pax = getPax();
      luggageVanHint.classList.toggle("hidden", !(pax === 4 && luggage === "many"));
      updateTravelConditionals();
      updateUrgentHint();

      // notes suggestion
      const tips = [];
      const airport = isAirportOrStationText(fromEl.value) || isAirportOrStationText(toEl.value);
      if (airport) tips.push(LANG === "en" ? "flight/train number" : "numero volo/treno");
      if (serviceNeedsHours()) tips.push(LANG === "en" ? "hours/time range" : "ore/fascia oraria");
      if (serviceNeedsReturn() && !returnTbdEl.checked) tips.push(LANG === "en" ? "return time" : "orario ritorno");
      if (meetGreet === "yes" && airport) tips.push("Meet & Greet");
      if ((vehicleEl.value || "") === VAN_LABEL) tips.push(LANG === "en" ? "luggage qty/size" : "bagagli (q.tà/dimensioni)");
      if (invoiceEl.checked) tips.push(LANG === "en" ? "invoice details" : "dati fattura");
      if (multiVehiclesEl.value && multiVehiclesEl.value !== "1") tips.push(LANG === "en" ? "vehicles count" : "numero veicoli");
      notesHintEl.textContent = tips.length ? ((LANG === "en" ? "Suggestion: " : "Suggerimento: ") + tips.join(" · ")) : "";
    }

    // ---------- alerts ----------
    function showAlert(lines) {
      const T = I18N[LANG];
      $("t_alert_title").textContent = T.alert.title;
      formAlertText.textContent = lines.join(" ");
      formAlert.classList.remove("hidden");
    }
    function hideAlert() {
      formAlert.classList.add("hidden");
      formAlertText.textContent = "";
    }

    // ---------- message builder ----------
    function getContextLine() {
      if (!lastContextTag) return "";
      const mapIt = { "Milan":"Milano", "Airports":"Aeroporti", "Lake Como":"Lago di Como" };
      const mapEn = { "Milan":"Milan", "Airports":"Airports", "Lake Como":"Lake Como" };
      const v = (LANG === "en") ? (mapEn[lastContextTag] || lastContextTag) : (mapIt[lastContextTag] || lastContextTag);
      return I18N[LANG].waTemplates.ctx + v + "\n\n";
    }

    function getLuggageLabel() {
      const T = I18N[LANG].quote;
      if (luggage === "none") return T.lugNone;
      if (luggage === "some") return T.lugSome;
      return T.lugMany;
    }

    function getPaymentLabel() {
      const T = I18N[LANG].quote;
      if (payment === "card") return T.payCard;
      if (payment === "cash") return T.payCash;
      if (payment === "bank") return T.payBank;
      return T.payApple;
    }

    function getServiceLabel() {
      const T = I18N[LANG].quote;
      if (serviceEl.value === "transfer_oneway") return T.service1;
      if (serviceEl.value === "transfer_roundtrip") return T.service2;
      return T.service3;
    }

    function getChildSeatLabel() {
      const T = I18N[LANG].quote;
      const v = (seatEl.value || "");
      if (!v) return "";
      if (v === "infant") return T.seat1;
      if (v === "child") return T.seat2;
      if (v === "booster") return T.seat3;
      return v;
    }

    function buildWhatsAppMessage(isUrgent=false) {
      const T = I18N[LANG];
      const L = T.waTemplates.labels;

      const vehicle = (vehicleEl.value || "").trim();
      const pax = (paxEl.value || "").trim();
      const from = (fromEl.value || "").trim();
      const to = (toEl.value || "").trim();
      const stops = (stopsEl.value || "").trim();
      const whenFmt = formatDT(LANG, (whenEl.value || "").trim());
      const service = getServiceLabel();

      const vehiclesN = (multiVehiclesEl.value || "1");
      const invoice = invoiceEl.checked ? (LANG === "en" ? "Yes" : "Sì") : (LANG === "en" ? "No" : "No");
      const name = (nameEl.value || "").trim();
      const phone = (phoneEl.value || "").trim();
      const notes = (notesEl.value || "").trim();

      const airportMode = !flightWrap.classList.contains("hidden");
      const flight = (flightEl.value || "").trim();
      const meet = (meetGreet === "yes") ? (LANG === "en" ? "Yes" : "Sì") : (LANG === "en" ? "No" : "No");
      const wait = (waitEl.value || "").trim();
      const seat = getChildSeatLabel();

      const big = bigEl.value;
      const carry = carryEl.value;

      const retTbd = returnTbdEl.checked;
      const ret = returnWhenEl.value ? formatDT(LANG, returnWhenEl.value) : "";
      const hours = (hoursEl.value || "").trim();

      let msg = "";
      if (isUrgent) msg += T.waTemplates.urgent;
      msg += getContextLine();
      msg += T.waTemplates.header;

      msg += `${L.service}: ${service}\n`;
      if (serviceNeedsHours()) msg += `${L.hours}: ${hours}\n`;
      if (serviceNeedsReturn()) msg += `${L.return}: ${retTbd ? (LANG === "en" ? "To be defined" : "Da definire") : ret}\n`;

      msg += `${L.vehicle}: ${vehicle}\n`;
      if (vehiclesN && vehiclesN !== "1") msg += `${L.vehiclesN}: ${vehiclesN}\n`;
      msg += `${L.from}: ${from}\n`;
      msg += `${L.to}: ${to}\n`;
      if (stops) msg += `${L.stops}: ${stops}\n`;
      msg += `${L.when}: ${whenFmt} (${TZ_LABEL})\n`;
      msg += `${L.pax}: ${pax}\n`;

      if (airportMode && flight) msg += `${L.flight}: ${flight}\n`;
      if (airportMode) {
        msg += `${L.meet}: ${meet}\n`;
        if (wait) msg += `${L.wait}: +${wait} min\n`;
        if (seat) msg += `${L.seat}: ${seat}\n`;
      }

      msg += `${L.lug}: ${getLuggageLabel()} (Large: ${big}, Carry-on: ${carry})\n`;
      msg += `${L.pay}: ${getPaymentLabel()}\n`;
      msg += `${L.inv}: ${invoice}\n`;
      msg += `${L.pref}: ${contactPref === "Call" ? (LANG === "en" ? "Call" : "Chiamata") : "WhatsApp"}\n`;

      if (name) msg += `${L.name}: ${name}\n`;
      if (phone) msg += `${L.phone}: ${phone}\n`;
      if (notes) msg += `${L.notes}: ${notes}\n`;

      return msg;
    }

    function baseWhatsAppMessage(isUrgent=false) {
      const T = I18N[LANG];
      let msg = "";
      if (isUrgent) msg += T.waTemplates.urgent;
      msg += getContextLine();
      msg += T.waTemplates.header;
      msg += (LANG === "en")
        ? "Pickup:\nDrop-off:\nDate/Time:\nPassengers:\nVehicle:\nNotes:\n"
        : "Partenza:\nDestinazione:\nData/Ora:\nPasseggeri:\nVeicolo:\nNote:\n";
      return msg;
    }

    // ---------- language apply ----------
    function setText(id, v) { const el = $(id); if (el) el.textContent = v; }
    function applyLang() {
      const T = I18N[LANG];
      document.documentElement.lang = LANG;

      setText("t_header_sub", T.headerSub);
      setText("t_nav_fleet", T.nav.fleet);
      setText("t_nav_quote", T.nav.quote);
      setText("t_nav_faq", T.nav.faq);

      setText("t_badge_1", T.badges.b1);
      setText("t_badge_2", T.badges.b2);
      setText("t_h1", T.h1);
      $("t_sub").innerText = T.sub;

      setText("t_microtrust", T.microtrust);
      setText("t_trustline", T.trustline);
      setText("t_email_label", T.email);
      setText("t_email_label_2", T.email);

      setText("t_season_title", T.seasonTitle);
      setText("t_season_desc", T.seasonDesc);

      setText("t_btn_whatsapp_top", T.btn.wa);
      setText("t_btn_wa_hero", T.btn.waHero);
      setText("t_btn_fill_details", T.btn.fill);
      setText("t_btn_open_wa_form", T.btn.openWa);
      setText("t_btn_fleet_quote_top", T.btn.fleetQuote);
      setText("t_submit", T.btn.submit);
      setText("t_reset", T.btn.reset);
      setText("t_urgent_btn", T.btn.urgentBtn);
      setText("t_urgent_call", T.btn.call);

      // intent
      setText("t_intent_milan_title", T.intent.milanTitle);
      setText("t_intent_milan_desc", T.intent.milanDesc);
      setText("t_intent_air_title", T.intent.airTitle);
      setText("t_intent_air_desc", T.intent.airDesc);
      setText("t_intent_lake_title", T.intent.lakeTitle);
      setText("t_intent_lake_desc", T.intent.lakeDesc);
      setText("t_intent_tap_1", T.intent.tap);
      setText("t_intent_tap_2", T.intent.tap);
      setText("t_intent_tap_3", T.intent.tap);

      // fleet
      setText("t_fleet_title", T.fleet.title);
      setText("t_fleet_sub", T.fleet.sub);
      setText("t_fleet_c1_t", T.fleet.c1t);
      setText("t_fleet_c1_d", T.fleet.c1d);
      setText("t_fleet_c2_t", T.fleet.c2t);
      setText("t_fleet_c2_d", T.fleet.c2d);
      setText("t_fleet_c3_t", T.fleet.c3t);
      setText("t_fleet_c3_d", T.fleet.c3d);
      setText("t_fleet_hint", T.fleet.hint);
      setText("t_selected_badge", T.fleet.selected);
      setText("t_selected_badge_2", T.fleet.selected);
      setText("t_selected_badge_3", T.fleet.selected);

      // quote
      setText("t_quote_title", T.quote.title);
      setText("t_quote_sub", T.quote.sub);
      setText("t_selected_vehicle_label", T.quote.selectedVehicle);
      setText("t_capacity_notice", T.quote.capNotice);
      setText("t_travel_hint", T.quote.travelHint);
      setText("t_luggage_hint", T.quote.luggageHint);
      setText("t_urgent_hint_t", T.quote.urgentT);
      setText("t_urgent_hint_d", T.quote.urgentD);

      setText("t_service_label", T.quote.serviceLabel);
      setText("t_service_opt1", T.quote.service1);
      setText("t_service_opt2", T.quote.service2);
      setText("t_service_opt3", T.quote.service3);

      setText("t_vehicle_label", T.quote.vehicleLabel);
      setText("t_vehicle_ph", T.quote.vehiclePH);
      setText("t_vehicle_cap_hint", T.quote.vehicleCapHint);

      setText("t_pax_label", T.quote.paxLabel);
      setText("t_pax_ph", T.quote.paxPH);

      setText("t_from_label", T.quote.fromLabel);
      fromEl.placeholder = T.quote.fromPH;
      setText("t_to_label", T.quote.toLabel);
      toEl.placeholder = T.quote.toPH;

      setText("t_stops_label", T.quote.stopsLabel);
      stopsEl.placeholder = T.quote.stopsPH;

      setText("t_when_label", T.quote.whenLabel);
      setText("t_when_tz", T.quote.whenTZ);

      setText("t_multi_label", T.quote.multiLabel);
      setText("t_multi_1", T.quote.multi1);
      setText("t_multi_2", T.quote.multi2);
      setText("t_multi_3", T.quote.multi3);
      setText("t_multi_4", T.quote.multi4);

      setText("t_return_label", T.quote.returnLabel);
      setText("t_return_tbd", T.quote.returnTbd);
      setText("t_return_hint", T.quote.returnHint);

      setText("t_hours_label", T.quote.hoursLabel);
      setText("t_hours_ph", T.quote.hoursPH);

      setText("t_flight_label", T.quote.flightLabel);

      setText("t_meet_label", T.quote.meetLabel);
      setText("t_meet_sub", T.quote.meetSub);
      meetNo.textContent = "No";
      meetYes.textContent = (LANG === "en") ? "Yes" : "Sì";

      setText("t_wait_label", T.quote.waitLabel);
      setText("t_wait_0", T.quote.wait0);
      setText("t_wait_hint", T.quote.waitHint);

      setText("t_seat_label", T.quote.seatLabel);
      setText("t_seat_0", T.quote.seat0);
      setText("t_seat_1", T.quote.seat1);
      setText("t_seat_2", T.quote.seat2);
      setText("t_seat_3", T.quote.seat3);

      setText("t_contactpref_label", T.quote.contactPref);
      prefWA.textContent = "WhatsApp";
      prefCall.textContent = (LANG === "en") ? "Call" : "Chiamata";

      setText("t_lug_label", T.quote.lugLabel);
      setText("t_lug_sub", T.quote.lugSub);
      setText("t_lug_none", T.quote.lugNone);
      setText("t_lug_some", T.quote.lugSome);
      setText("t_lug_many", T.quote.lugMany);

      setText("t_big_label", T.quote.bigLabel);
      setText("t_carry_label", T.quote.carryLabel);

      setText("t_payment_label", T.quote.payLabel);
      setText("t_pay_card", T.quote.payCard);
      setText("t_pay_cash", T.quote.payCash);
      setText("t_pay_bank", T.quote.payBank);
      setText("t_pay_apple", T.quote.payApple);

      setText("t_invoice_label", T.quote.invoiceLabel);

      setText("t_name_label", T.quote.nameLabel);
      nameEl.placeholder = T.quote.namePH;

      setText("t_phone_label", T.quote.phoneLabel);
      phoneEl.placeholder = T.quote.phonePH;

      setText("t_notes_label", T.quote.notesLabel);
      notesEl.placeholder = T.quote.notesPH;

      setText("t_privacy_note", T.quote.privacyNote);

      // reviews/faq/footer
      setText("t_reviews_title", T.reviews.title);
      setText("t_reviews_sub", T.reviews.sub);

      setText("t_faq_title", T.faq.title);
      setText("t_faq_q1", T.faq.q1);
      setText("t_faq_a1", T.faq.a1);
      setText("t_faq_q2", T.faq.q2);
      setText("t_faq_a2", T.faq.a2);
      setText("t_faq_q3", T.faq.q3);
      setText("t_faq_a3", T.faq.a3);
      setText("t_faq_q4", T.faq.q4);
      setText("t_faq_a4", T.faq.a4);

      setText("t_footer_sub", T.footer.sub);
      setText("t_footer_links", T.footer.links);
      setText("t_footer_wa", T.footer.wa);
      setText("t_footer_call", T.footer.call);
      setText("t_footer_quote", T.footer.quote);
      setText("t_sticky_wa", T.footer.wa);
      setText("t_sticky_quote", T.footer.quote);

      updateHints();
    }

    function setLanguage(lang) {
      LANG = (lang === "en") ? "en" : "it";
      localStorage.setItem("nexaride_lang", LANG);
      $("langIT").classList.toggle("is-active", LANG === "it");
      $("langEN").classList.toggle("is-active", LANG === "en");
      applyLang();
      save();
    }

    // ---------- storage ----------
    function save() {
      const payload = {
        lang: LANG,
        contactPref,
        luggage,
        meetGreet,
        payment,
        contextTag: lastContextTag || "",
        vehicle: vehicleEl.value || "",
        pax: paxEl.value || "",
        from: fromEl.value || "",
        to: toEl.value || "",
        stops: stopsEl.value || "",
        when: whenEl.value || "",
        serviceType: serviceEl.value || "transfer_oneway",
        returnWhen: returnWhenEl.value || "",
        returnTbd: !!returnTbdEl.checked,
        hours: hoursEl.value || "",
        flightNumber: flightEl.value || "",
        waitTime: waitEl.value || "",
        childSeat: seatEl.value || "",
        bigSuitcases: bigEl.value || "0",
        carryOn: carryEl.value || "0",
        multiVehicles: multiVehiclesEl.value || "1",
        invoice: !!invoiceEl.checked,
        name: nameEl.value || "",
        phone: phoneEl.value || "",
        notes: notesEl.value || ""
      };
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(payload)); } catch(e) {}
    }

    function restore() {
      let raw = null;
      try { raw = localStorage.getItem(STORAGE_KEY); } catch(e) {}
      if (!raw) return;
      let p = null;
      try { p = JSON.parse(raw); } catch(e) { return; }
      if (!p || typeof p !== "object") return;

      if (p.lang === "it" || p.lang === "en") LANG = p.lang;

      contactPref = (p.contactPref === "Call") ? "Call" : "WhatsApp";
      luggage = ["none","some","many"].includes(p.luggage) ? p.luggage : "none";
      meetGreet = (p.meetGreet === "yes") ? "yes" : "no";
      payment = ["card","cash","bank","apple"].includes(p.payment) ? p.payment : "card";
      lastContextTag = p.contextTag || "";

      vehicleEl.value = p.vehicle || "";
      paxEl.value = p.pax || "";
      fromEl.value = p.from || "";
      toEl.value = p.to || "";
      stopsEl.value = p.stops || "";
      whenEl.value = p.when || "";
      serviceEl.value = p.serviceType || "transfer_oneway";
      returnWhenEl.value = p.returnWhen || "";
      returnTbdEl.checked = !!p.returnTbd;
      hoursEl.value = p.hours || "";
      flightEl.value = p.flightNumber || "";
      waitEl.value = p.waitTime || "";
      seatEl.value = p.childSeat || "";
      bigEl.value = p.bigSuitcases || "0";
      carryEl.value = p.carryOn || "0";
      multiVehiclesEl.value = p.multiVehicles || "1";
      invoiceEl.checked = !!p.invoice;
      nameEl.value = p.name || "";
      phoneEl.value = p.phone || "";
      notesEl.value = p.notes || "";

      setContactPref(contactPref);
      setMeet(meetGreet);
      setPayment(payment);

      // luggage buttons
      lugNone.setAttribute("aria-pressed", luggage === "none" ? "true" : "false");
      lugSome.setAttribute("aria-pressed", luggage === "some" ? "true" : "false");
      lugMany.setAttribute("aria-pressed", luggage === "many" ? "true" : "false");

      selectFleetByLabel(vehicleEl.value);
      updateSelectedVehicleUI();
    }

    // ---------- scrolling ----------
    function scrollToQuoteAndFocus() {
      $("quote").scrollIntoView({ behavior: "smooth", block: "start" });
      setTimeout(() => {
        const first = getFirstMissingField();
        (first || vehicleEl).focus({ preventScroll: true });
      }, 350);
    }

    function getFirstMissingField() {
      if (!vehicleEl.value) return vehicleEl;
      if (!paxEl.value) return paxEl;
      if (!fromEl.value.trim()) return fromEl;
      if (!toEl.value.trim()) return toEl;
      if (!whenEl.value) return whenEl;
      if (serviceNeedsHours() && !hoursEl.value) return hoursEl;
      if (serviceNeedsReturn() && !returnTbdEl.checked && !returnWhenEl.value) return returnWhenEl;
      return null;
    }

    // ---------- init ----------
    $("y").textContent = new Date().getFullYear();

    // language buttons
    $("langIT").addEventListener("click", () => setLanguage("it"));
    $("langEN").addEventListener("click", () => setLanguage("en"));

    // WhatsApp CTAs (base message)
    $("ctaWATop").addEventListener("click", () => openWhatsApp(baseWhatsAppMessage(false)));
    $("ctaWAHero").addEventListener("click", () => openWhatsApp(baseWhatsAppMessage(false)));
    $("ctaWAOpenGeneric").addEventListener("click", () => openWhatsApp(baseWhatsAppMessage(false)));
    $("ctaWAFooter").addEventListener("click", () => openWhatsApp(baseWhatsAppMessage(false)));
    $("stickyWA").addEventListener("click", () => openWhatsApp(baseWhatsAppMessage(false)));
    $("waInline").addEventListener("click", () => openWhatsApp(baseWhatsAppMessage(false)));

    // form CTAs
    $("ctaScrollToForm").addEventListener("click", scrollToQuoteAndFocus);
    $("ctaFleetToForm").addEventListener("click", scrollToQuoteAndFocus);
    $("stickyQuote").addEventListener("click", scrollToQuoteAndFocus);
    $("ctaFooterToForm").addEventListener("click", scrollToQuoteAndFocus);

    // intent cards: set context + light prefill + go form
    function prefillIntent(ctx) {
      lastContextTag = ctx || "";
      if (ctx === "Airports") {
        if (!toEl.value && !fromEl.value) toEl.value = (LANG === "en" ? "MXP Malpensa Airport" : "MXP Malpensa");
      }
      if (ctx === "Lake Como") {
        if (!toEl.value && !fromEl.value) toEl.value = (LANG === "en" ? "Lake Como (Como/Bellagio)" : "Lago di Como (Como/Bellagio)");
      }
      save();
      updateHints();
    }

    $("intentMilan").addEventListener("click", () => { prefillIntent("Milan"); scrollToQuoteAndFocus(); });
    $("intentAirports").addEventListener("click", () => { prefillIntent("Airports"); scrollToQuoteAndFocus(); });
    $("intentLake").addEventListener("click", () => { prefillIntent("Lake Como"); scrollToQuoteAndFocus(); });

    // fleet selection
    document.querySelectorAll(".fleet-card").forEach(card => {
      card.addEventListener("click", () => {
        const label = card.getAttribute("data-vehicle-label");
        if (!label) return;
        vehicleEl.value = label;
        selectFleetByLabel(label);
        updateSelectedVehicleUI();
        enforceCapacity();
        scrollToQuoteAndFocus();
      });
    });

    // toggles
    prefWA.addEventListener("click", () => { setContactPref("WhatsApp"); save(); });
    prefCall.addEventListener("click", () => { setContactPref("Call"); save(); });

    lugNone.addEventListener("click", () => setLuggage("none"));
    lugSome.addEventListener("click", () => setLuggage("some"));
    lugMany.addEventListener("click", () => setLuggage("many"));

    meetNo.addEventListener("click", () => { setMeet("no"); updateHints(); });
    meetYes.addEventListener("click", () => { setMeet("yes"); updateHints(); });

    payCard.addEventListener("click", () => setPayment("card"));
    payCash.addEventListener("click", () => setPayment("cash"));
    payBank.addEventListener("click", () => setPayment("bank"));
    payApple.addEventListener("click", () => setPayment("apple"));

    // fields reactions
    serviceEl.addEventListener("change", () => { updateServiceConditionals(); updateHints(); });
    returnTbdEl.addEventListener("change", () => { updateServiceConditionals(); updateHints(); });
    returnWhenEl.addEventListener("change", () => save());
    hoursEl.addEventListener("change", () => save());

    vehicleEl.addEventListener("change", () => {
      selectFleetByLabel(vehicleEl.value);
      updateSelectedVehicleUI();
      enforceCapacity();
    });

    paxEl.addEventListener("change", () => enforceCapacity());

    fromEl.addEventListener("input", () => { updateHints(); save(); });
    toEl.addEventListener("input", () => { updateHints(); save(); });
    stopsEl.addEventListener("input", () => save());
    whenEl.addEventListener("focus", () => setMinNow(whenEl));
    whenEl.addEventListener("change", () => { updateHints(); save(); });

    flightEl.addEventListener("input", () => save());
    waitEl.addEventListener("change", () => save());
    seatEl.addEventListener("change", () => save());

    bigEl.addEventListener("change", () => { updateHints(); save(); });
    carryEl.addEventListener("change", () => { updateHints(); save(); });

    multiVehiclesEl.addEventListener("change", () => save());
    invoiceEl.addEventListener("change", () => { updateHints(); save(); });
    nameEl.addEventListener("input", () => save());
    phoneEl.addEventListener("input", () => save());
    notesEl.addEventListener("input", () => save());

    // urgent WA
    urgentWA.addEventListener("click", () => openWhatsApp(baseWhatsAppMessage(true)));

    // submit: anti double + focus missing + capacity enforcement
    $("quoteForm").addEventListener("submit", (e) => {
      e.preventDefault();
      hideAlert();

      const now = Date.now();
      if (isSubmitting || (now - lastSubmitAt) < 1500) {
        showToast(I18N[LANG].toasts.blocked);
        return;
      }

      // enforce capacity before validating
      enforceCapacity();

      const missing = [];
      const T = I18N[LANG];

      if (!vehicleEl.value) missing.push(T.quote.vehicleLabel);
      if (!paxEl.value) missing.push(T.quote.paxLabel);
      if (!fromEl.value.trim()) missing.push(T.quote.fromLabel);
      if (!toEl.value.trim()) missing.push(T.quote.toLabel);
      if (!whenEl.value) missing.push(T.quote.whenLabel);
      if (serviceNeedsHours() && !hoursEl.value) missing.push(T.quote.hoursLabel);
      if (serviceNeedsReturn() && !returnTbdEl.checked && !returnWhenEl.value) missing.push(T.quote.returnLabel);

      if (missing.length) {
        showAlert([T.alert.missingPrefix + missing.join(" · ")]);
        scrollToQuoteAndFocus();
        return;
      }

      // urgent?
      const dt = parseDT(whenEl.value);
      const urgent = dt ? (((dt.getTime() - Date.now()) / 3600000) >= 0 && ((dt.getTime() - Date.now()) / 3600000) <= 2) : false;

      isSubmitting = true;
      lastSubmitAt = now;
      submitBtn.disabled = true;
      submitBtn.classList.add("opacity-70");

      save();
      openWhatsApp(buildWhatsAppMessage(urgent));

      setTimeout(() => {
        isSubmitting = false;
        submitBtn.disabled = false;
        submitBtn.classList.remove("opacity-70");
      }, 1800);
    });

    // reset
    $("resetBtn").addEventListener("click", () => {
      $("quoteForm").reset();
      hideAlert();

      lastContextTag = "";
      setContactPref("WhatsApp");
      luggage = "none";
      lugNone.setAttribute("aria-pressed","true");
      lugSome.setAttribute("aria-pressed","false");
      lugMany.setAttribute("aria-pressed","false");

      setMeet("no");
      setPayment("card");

      clearFleetSelection();
      updateSelectedVehicleUI();

      // clear conditionals
      returnTbdEl.checked = false;
      returnWhenEl.value = "";
      hoursEl.value = "";
      flightEl.value = "";
      waitEl.value = "";
      seatEl.value = "";

      // hide notices
      capacityNotice.classList.add("hidden");
      travelHint.classList.add("hidden");
      flightWrap.classList.add("hidden");
      meetWrap.classList.add("hidden");
      airportExtrasWrap.classList.add("hidden");
      luggageVanHint.classList.add("hidden");
      urgentHint.classList.add("hidden");
      returnWrap.classList.add("hidden");
      hoursWrap.classList.add("hidden");

      try { localStorage.removeItem(STORAGE_KEY); } catch(e) {}

      updateServiceConditionals();
      updateHints();
      save();
    });

    // ---------- boot ----------
    setMinNow(whenEl);
    setMinNow(returnWhenEl);

    restore();
    // apply lang after restore
    setLanguage(LANG);

    // initial
    updateServiceConditionals();
    updateSelectedVehicleUI();
    enforceCapacity();
    updateHints();
  </script>
</body>
</html>
```
